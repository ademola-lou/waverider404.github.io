var canvas=document.getElementById("renderCanvas"),engine=null,scene=null,sceneToRender=null,createDefaultEngine=function(){return new BABYLON.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1})},isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),gameOver=!1,CreateScene=function(e,t){var a=new BABYLON.Scene(e);a.fogMode=BABYLON.Scene.FOGMODE_EXP2,a.fogColor=new BABYLON.Color3(.35,.41,.45),a.fogDensity=.04,a.clearColor=BABYLON.Color4.FromColor3(a.fogColor);var i=new BABYLON.FreeCamera("camera1",new BABYLON.Vector3(0,5,-10),a);i.layerMask=1;var r=new BABYLON.ArcRotateCamera("camera1",0,0,0,new BABYLON.Vector3(0,0,0),a);r.angularSensibilityX=1e4,r.angularSensibilityY=1e4,r.layerMask=2,a.activeCameras=[i,r],isMobile?(r.angularSensibilityX=1e3,r.angularSensibilityY=1e3):a.getEngine().isPointerLock=!0,new BABYLON.HemisphericLight("light",new BABYLON.Vector3(0,1,0),a).intensity=.7;var o=new expressGo(a);return o.focusCam=r,i.parent=o.player,i.position.y-=6,i.position.z+=6,a.registerBeforeRender(function(){o.update()}),a.onReadyObservable.add(function(){console.clear(),console.log("Welcome to train game!"),a.meshes.forEach(function(e){e.layerMask=1}),r.attachControl(t,!0)}),a},expressGo=function(){function e(e){this.SPEED_LIMIT=0,this.score=0,this.trainCarriage=new Array(12),this.playerParam={size:3,xp:0,currentWeapon:null},this.trainParam={length:30,gap:6,speed:.1},this.zombieHoardes=new Array(1),this.zombieSpeed=.1,this.animatables=[],this.trackPoints=[],this.marker=BABYLON.Vector3.Zero(),this.scene=e,this.createTrack(),this.createPlayer(),this.createZombies(),this.skybox=BABYLON.MeshBuilder.CreateSphere("skyBox",{diameter:150},e),this.skyboxMaterial=new BABYLON.BackgroundMaterial("skyBox",e),this.skyboxMaterial.backFaceCulling=!1,this.skyboxMaterial.diffuseTexture=new BABYLON.Texture("https://cdn.glitch.com/c9e2f109-17ee-4937-bdaf-b65c3829c52f%2Fsky.jpg?v=1620664838795"),this.skyboxMaterial.diffuseTexture.uScale=10,this.skyboxMaterial.diffuseTexture.vScale=10,this.skybox.material=this.skyboxMaterial,this.health=100;var t=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),a=BABYLON.GUI.Button.CreateImageOnlyButton("menubut","https://cdn.glitch.com/9fc921e3-db5b-4af6-9426-ecd872050c1f%2Fwhite-paint-brush-stroke-2.png?v=1568860181233");a.width=.2,a.height="40px",a.color="transparent",a.background="transparent",a.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,a.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,t.addControl(a);var i=new BABYLON.GUI.TextBlock;i.text="Menu",i.color="black",i.fontSize=24,i.fontFamily="Impact",a.addControl(i);var r=BABYLON.GUI.Button.CreateImageOnlyButton("scoreboard","https://cdn.glitch.com/9fc921e3-db5b-4af6-9426-ecd872050c1f%2Fwhite-paint-brush-stroke-2.png?v=1568860181233");r.width=.2,r.height="100px",r.background="transparent",r.color="transparent",t.addControl(r),r.pointerDownAnimation=function(){},r.pointerUpAnimation=function(){};var o=new BABYLON.GUI.TextBlock;o.color="black",o.fontSize=24,o.fontFamily="Impact",r.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,r.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,r.addControl(o);var n=new BABYLON.GUI.Rectangle;n.width=.4,n.height="40px",n.cornerRadius=20,n.color="transparent",n.thickness=4,n.background="transparent",n.paddingRight=this.health,n.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT,n.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,t.addControl(n);var s=new BABYLON.GUI.TextBlock;if(s.color="black",s.fontSize=24,s.fontFamily="Impact",s.text="Health: "+this.health+"%",n.addControl(s),this.scoreBoard=this.scoreBoard,this.scoreText=o,this.healthbar=n,this.healthtext=s,this.levelEnd=!1,isMobile){var l=BABYLON.GUI.Button.CreateImageOnlyButton("menubut","https://cdn.glitch.com/c9e2f109-17ee-4937-bdaf-b65c3829c52f%2Fcannon.png?v=1621119895600");l.width=.1,l.height=.2,l.color="transparent",l.background="transparent",l.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT,l.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,t.addControl(l),this.shootButton=l}this.invertX=-1;var c=this,h=function(e){return 0|e},m=new BABYLON.GUI.SelectionPanel("sp");m.width=.25,m.height=1,m.background="gray",m.fontFamily="impact",t.addControl(m);var d=new BABYLON.GUI.CheckboxGroup("Look Inversion");d.addCheckbox("invert",function(e){c.invertX=e?1:-1});var p=new BABYLON.GUI.SliderGroup("Sensitivity","S");p.addSlider("Horizontal Ads",function(e){c.scene.activeCameras[1].angularSensibilityX=1e4*e},"",.5,5,1,h),p.addSlider("Vertical Ads",function(e){c.scene.activeCameras[1].angularSensibilityY=1e4*e},"",.5,5,1,h);var B=new BABYLON.GUI.SliderGroup("Volume","S");B.addSlider("volume",function(e){c.scene.sounds.forEach(t=>{t.setVolume(e)})},"",0,5,1,h),m.addGroup(d),m.addGroup(p),m.addGroup(B);var u=BABYLON.GUI.Button.CreateSimpleButton("but","Guide");u.width=.5,u.height="40px",u.color="white",u.background="black",m.addControl(u),u.onPointerUpObservable.add(()=>{b&&(b.isVisible=!0)});var g=BABYLON.GUI.Button.CreateSimpleButton("but","Restart");g.width=.5,g.height="40px",g.color="white",g.background="black",g.top=100,m.addControl(g),m.isVisible=!1,this.menuBox=m,g.onPointerUpObservable.add(()=>{engine&&c.scene&&(sceneToRender=CreateScene(),c.scene=sceneToRender,c.player.data.currentWeapon.bullets.length=0,c.player.data.currentWeapon.bullets=[])}),a.onPointerUpObservable.add(()=>{m.isVisible=!m.isVisible,0==c.levelEnd&&(m.isVisible?c.scene.animationsEnabled=!1:c.scene.animationsEnabled=!0)});c=this;this.ambient=new BABYLON.Sound("Violons","https://cdn.glitch.com/5720d067-8492-4523-aa2c-0974bc11e98e%2FExodus%20-%20XEHLA%20Free%20Royalty%20Free%20Music%20No%20Copyright%20Upbeat%20Instrumental%20Music%20For%20Free%20Downloa%20(1).wav",e,null,{loop:!0,autoplay:!0}),this.shootSound=new BABYLON.Sound("Violons","https://cdn.glitch.com/5720d067-8492-4523-aa2c-0974bc11e98e%2F376694__daleonfire__laser.wav",e,null,{loop:!1}),this.explodeSound=new BABYLON.Sound("Violons","https://cdn.glitch.com/5720d067-8492-4523-aa2c-0974bc11e98e%2F151022__bubaproducer__laser-shot-silenced.wav",e,null,{loop:!1}),null==localStorage.getItem("highscore")&&localStorage.setItem("highscore",this.score),o.text=`\nScore: ${this.score}\nBest Score: ${localStorage.getItem("highscore")}`;var b=new BABYLON.GUI.Rectangle;b.width=1,b.height=1,b.color="white",b.background="black",b.alpha=.8,t.addControl(b);var f=new BABYLON.GUI.TextBlock;f.color="white",f.fontSize=24,f.fontFamily="Impact",f.text="\nWelcome to my minigame 'zombie free runner' where you on the epilounge to destroy all zombies coming your way\n\nHow to play:\nMove the mouse left and right to controll the player, press spacebar to shoot the zombies, simple eh?",b.addControl(f);var A=BABYLON.GUI.Button.CreateSimpleButton("but","close");A.width=.2,A.height=.05,A.color="white",A.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM,b.addControl(A),A.onPointerUpObservable.add(()=>{b.isVisible=!1}),this.scene.onReadyObservable.add(function(){setTimeout(()=>{b.isVisible=!1},3e3)})}e.prototype.clamp=function(e,t,a){return e<=t?t:e>=a?a:e},e.prototype.explodeZombies=function(e){var t=BABYLON.MeshBuilder.CreateBox("smoke",{size:.5}),a=new BABYLON.SolidParticleSystem("SPS",this.scene);a.addShape(t,10);var i=a.buildMesh();i.material=new BABYLON.SimpleMaterial("smokeMat"),i.position.y=-50,t.dispose();a.initParticles=function(){for(var e=0;e<this.nbParticles;e++)this.recycleParticle(this.particles[e])},a.recycleParticle=function(e){e.position.x=0,e.position.y=0,e.position.z=0,e.velocity.x=1.5*(Math.random()-.5),e.velocity.y=1.5*Math.random(),e.velocity.z=1.5*(Math.random()-.5);e.scale.x=1,e.scale.y=1,e.scale.z=1,e.rotation.x=3.5*Math.random(),e.rotation.y=3.5*Math.random(),e.rotation.z=3.5*Math.random(),e.scaleFactor=.05,e.color=new BABYLON.Color3(Math.random(),Math.random(),Math.random())},a.updateParticle=function(e){e.position.y>100&&this.recycleParticle(e),e.position.y+=.5,e.position.addInPlace(e.velocity),e.scale.x+=e.scaleFactor,e.scale.y+=e.scaleFactor,e.scale.z+=e.scaleFactor},a.initParticles(),a.setParticles(),i.scaling.scaleInPlace(.1),i.position.copyFrom(e.getAbsolutePosition()),i.lifetime=50,e.smokeParticle={mesh:i,sps:a}},e.prototype.shoot=function(e,t){var a=e.bullets,i=a.length+1;this.scene.activeCameras[1];a[i]=BABYLON.MeshBuilder.CreateSphere("bullet",{diameter:.5},this.scene),a[i].position=e.getAbsolutePosition().add(e.up.scale(1)),a[i].speed=.5,a[i].life=50,a[i].rotationQuaternion=BABYLON.Quaternion.FromLookDirectionLH(e.up,e.right),a[i].material=new BABYLON.SimpleMaterial("texture1",this.scene),a[i].material.diffuseColor=new BABYLON.Color3(0,0,0)},e.prototype.createCarriage=function(){var e=BABYLON.MeshBuilder.CreateBox("trainCarriage0",{size:3}),t=BABYLON.MeshBuilder.CreateBox("chain",{width:.5,height:1,depth:3});t.position.copyFrom(e.right.scale(1.5)),t.position.y-=1;var a=BABYLON.MeshBuilder.CreateCylinder("wheel_1",{diameter:2,tessellation:8,height:.4});a.position.copyFrom(t.position),a.rotate(BABYLON.Axis.Z,Math.PI/2),a.position.z-=1;var i=a.clone();i.position.z+=2;var r=BABYLON.Mesh.MergeMeshes([t,a,i]);e.material=new BABYLON.SimpleMaterial("mat",this.scene),e.material.diffuseColor=BABYLON.Color3.FromHexString("#1923C0").scale(5),r.material=new BABYLON.SimpleMaterial("mat",this.scene),r.material.diffuseColor=BABYLON.Color3.Gray().scale(.5);var o=r.clone();return o.position.copyFrom(e.right.scale(-3)),BABYLON.Mesh.MergeMeshes([e,r,o],!0,!0,null,!0,!0)},e.prototype.createPlayer=function(){var e=this;this.player=BABYLON.MeshBuilder.CreateBox("player",{size:this.playerParam.size/4}),this.player.data=this.playerParam;var t=this.player,a=this.scene,i=a.activeCameras[1];t.data.currentWeapon=new this.createWeapon(1),t.data.currentWeapon.bullets=[];const r=BABYLON.MeshBuilder.CreateBox("boxcollider",{width:.5,depth:.5,height:1});r.isVisible=!1,r.parent=t,t.state={aabb:r},BABYLON.SceneLoader.ImportMeshAsync(null,"https://cdn.glitch.com/","c9e2f109-17ee-4937-bdaf-b65c3829c52f%2Fstickmanshoot3.glb?v=1613195104107",a).then(function(r){r.meshes[0].scaling.scaleInPlace(.2),r.meshes[0].scaling.z=r.meshes[0].scaling.z,r.meshes[0].parent=t,r.meshes[0].position.y-=1.5;var o=r.skeletons[0];r.meshes.forEach(e=>{null!=e.material&&(e.material=new BABYLON.SimpleMaterial,e.material.diffuseColor=BABYLON.Color3.Red().scale(5),e.layerMask=1)});var n=o.getBoneIndexByName("mixamorig:RightHand"),s=o.getBoneIndexByName("mixamorig:Spine");function l(a){32==a.which&&(e.shoot(t.data.currentWeapon,{position:o.bones[s].getPosition()}),e.shootSound.play())}t.data.currentWeapon.attachToBone(o.bones[n],r.meshes[0]),t.data.currentWeapon.scaling.scaleInPlace(100),t.data.currentWeapon.position.y+=30,t.data.currentWeapon.position.z-=50,isMobile?e.shootButton.onPointerUpObservable.add(()=>{e.shoot(t.data.currentWeapon,{position:o.bones[s].getPosition()}),e.shootSound.play()}):(document.removeEventListener("keydown",l),document.addEventListener("keydown",l)),a.registerAfterRender(function(){i.alpha=function(e,t,a){return e<=t?t:e>=a?a:e}(i.alpha,-1.05,1.05),i.beta=0,o.bones[s].setRotation(new BABYLON.Vector3(e.invertX*i.beta,e.invertX*i.alpha,0),BABYLON.Space.LOCAL,r.meshes[0]);for(var a=t.data.currentWeapon.bullets,n=0,l=a.length;n<l;n+=1)if(a[n]&&null!=a[n]){a[n].locallyTranslate(new BABYLON.Vector3(0,0,-a[n].speed)),a[n].life--;for(var c=0;c<e.zombieTransform.hoardes.length;c++)a[n].intersectsMesh(e.zombieTransform.hoardes[c].state.aabb,!0)&&e.zombieTransform.hoardes[c].isEnabled()&&(a[n].dispose(),e.zombieTransform.hoardes[c].setEnabled(!1),e.zombieTransform.zombieLeft--,e.explodeSound.play(),e.score+=100,e.scoreText.text=`\nScore: ${e.score}\nBest Score: ${localStorage.getItem("highscore")}`,e.score>=localStorage.getItem("highscore")&&localStorage.setItem("highscore",e.score),e.explodeZombies(e.zombieTransform.hoardes[c]));0==a[n].life&&a[n].dispose()}});const c=a.getAnimationGroupByName("walk");c.start(!0,1,c.from,c.to);const h=a.getAnimationGroupByName("slide");document.addEventListener("keydown",e=>{e.repeat||83==e.which&&h.start()})}),this.player.isVisible=!1,this.createTrain()},e.prototype.smokeEmitter=function(e){var t=BABYLON.MeshBuilder.CreateSphere("smoke",{diameter:4,segments:2}),a=new BABYLON.SolidParticleSystem("SPS",this.scene);a.addShape(t,10);var i=a.buildMesh();i.material=new BABYLON.SimpleMaterial("smokeMat"),i.position.y=-50,t.dispose();a.initParticles=function(){for(var e=0;e<this.nbParticles;e++)this.recycleParticle(this.particles[e])},a.recycleParticle=function(e){e.position.x=0,e.position.y=0,e.position.z=0,e.velocity.x=1.5*(Math.random()-.5),e.velocity.y=1.5*Math.random(),e.velocity.z=1.5*(Math.random()-.5);e.scale.x=1,e.scale.y=1,e.scale.z=1,e.rotation.x=3.5*Math.random(),e.rotation.y=3.5*Math.random(),e.rotation.z=3.5*Math.random(),e.scaleFactor=.05},a.updateParticle=function(e){e.position.y>100&&this.recycleParticle(e),e.position.y+=.5,e.position.addInPlace(e.velocity),e.scale.x+=e.scaleFactor,e.scale.y+=e.scaleFactor,e.scale.z+=e.scaleFactor},a.initParticles(),a.setParticles(),i.scaling.scaleInPlace(.1),this.SPS=a,this.smokeContainer=i},e.prototype.createWeapon=function(e){var t;switch(e){case 1:t=BABYLON.MeshBuilder.CreateBox("",{width:1,height:4,depth:.3});break;case 2:t=BABYLON.MeshBuilder.CreateSphere("",{diameter:.5});break;default:t=BABYLON.MeshBuilder.CreateBox("",{size:.5})}return t.material=new BABYLON.SimpleMaterial("weaponMat"),t.material.diffuseColor=BABYLON.Color3.Teal(),t},e.prototype.createZombies=function(){var e=this;e.zombieTransform.hoardes=new Array(5);var t=this.scene,a=function(e,t,a,i){let r=e.instantiateModelsToScene();for(var o of r.rootNodes)o.position.z=t,o.layerMask=1,o.scaling.scaleInPlace(.5),a.hoardes[i]=o;for(var n of r.animationGroups)n.play(!0)};BABYLON.SceneLoader.LoadAssetContainer("https://cdn.glitch.com/","c9e2f109-17ee-4937-bdaf-b65c3829c52f%2Fstickmanzombie.glb?v=1613195885714",t,function(t){t.addAllToScene(),t.meshes.forEach(e=>{e.material=new BABYLON.SimpleMaterial,e.material.diffuseColor=BABYLON.Color3.Green().scale(5)});for(var i=0;i<e.zombieTransform.hoardes.length;i++){var r=1.5-3*Math.random(),o=1.5-3*Math.random();a(t,0,e.zombieTransform,i),e.zombieTransform.hoardes[i].position.y+=1.5,e.zombieTransform.hoardes[i].position.x=r,e.zombieTransform.hoardes[i].position.z=o;const n=BABYLON.MeshBuilder.CreateBox("boxcollider",{width:.5,depth:.5,height:4});n.position.y+=1.5,n.isVisible=!1,n.parent=e.zombieTransform.hoardes[i],e.zombieTransform.hoardes[i].state={aabb:n},e.zombieTransform.zombieLeft=e.zombieTransform.hoardes.length}}),e.zombieTransform.isVisible=!1,e.zombieTransform.animationGroup.onAnimationGroupEndObservable.add(()=>{e.trainCarriage[e.trainCarriage.length-1].animationGroup.animatables[0]&&e.trainCarriage[0].animationGroup.animatables[0]&&0==e.levelEnd&&(e.zombieTransform.hoardes.forEach((t,a)=>{t.setEnabled(!0),e.zombieTransform.zombieLeft=e.zombieTransform.hoardes.length}),originFrame=e.trainCarriage[e.trainCarriage.length-1].animationGroup.animatables[0].getAnimations()[0].currentFrame,targetFrame=e.trainCarriage[4].animationGroup.animatables[0].getAnimations()[0].currentFrame,e.zombieTransform.animationGroup.start(!1,e.zombieSpeed,originFrame,targetFrame))}),setTimeout(()=>{this.startHoard=!0},3e3)},e.prototype.createTrain=function(){this.createAnimatables(this.trackPoints);for(var e=this,t=e.createCarriage(),a=0;a<this.trainCarriage.length;a++)this.trainCarriage[a]=t.createInstance(),this.trainCarriage[a].animationGroup=new BABYLON.AnimationGroup("Group"),this.trainCarriage[a].animationGroup.addTargetedAnimation(this.animatables[0],this.trainCarriage[a]),this.trainCarriage[a].animationGroup.start(!1,this.trainParam.speed,this.trainCarriage[a].animationGroup.from+this.trainParam.length*(a/this.trainParam.gap),this.trainCarriage[a].animationGroup.to);t.isVisible=!1,this.smokeEmitter(this.trainCarriage[this.trainCarriage.length-1]),this.trainCarriage[this.trainCarriage.length-1].animationGroup.onAnimationGroupEndObservable.add(()=>{e.levelEnd=!0});var i=BABYLON.MeshBuilder.CreateBox("trainCarriage"+a,{height:4});i.animationGroup=new BABYLON.AnimationGroup("zombieGroup"),i.animationGroup.addTargetedAnimation(this.animatables[0],i);var r=this.trainCarriage[this.trainCarriage.length-1].animationGroup.animatables[0].fromFrame,o=this.trainCarriage[4].animationGroup.animatables[0].fromFrame;i.animationGroup.start(!1,e.zombieSpeed,r,o),this.zombieTransform=i,this.trainCarriage[this.trainCarriage.length-1].isVisible=!1,this.camTransform=this.trainCarriage[0],this.camTransform.isVisible=!1,this.player.setParent(this.trainCarriage[1])},e.prototype.createAnimatables=function(e){for(var t=new BABYLON.Path3D(e),a=(t.getCurve(),t.getTangents(),t.getNormals(),t.getBinormals(),new BABYLON.Animation("animPos","position",30,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE)),i=[],r=0;r<e.length;r++)i.push({frame:r,value:e[r]});a.setKeys(i),this.animatables.push(a)},e.prototype.createTrack=function(){for(var e=450,t=50,a=[],i=Math.floor(200*Math.random())+5,r=Math.floor(200*Math.random())+8,o=0;o<451;o++)this.trackPoints.push(new BABYLON.Vector3((t+t/i*Math.sin(8*o*Math.PI/e))*Math.sin(2*o*Math.PI/e),1,(t+t/r*Math.sin(6*o*Math.PI/e))*Math.cos(2*o*Math.PI/e)));t=54;for(o=0;o<451;o++)a.push(new BABYLON.Vector3((t+t/i*Math.sin(8*o*Math.PI/e))*Math.sin(2*o*Math.PI/e),0,(t+t/r*Math.sin(6*o*Math.PI/e))*Math.cos(2*o*Math.PI/e)));var n=BABYLON.MeshBuilder.CreateLines("track",{points:a});n.color=new BABYLON.Color3(0,0,0);var s=[];t=47;for(o=0;o<451;o++)s.push(new BABYLON.Vector3((t+t/i*Math.sin(8*o*Math.PI/e))*Math.sin(2*o*Math.PI/e),0,(t+t/r*Math.sin(6*o*Math.PI/e))*Math.cos(2*o*Math.PI/e)));var l=BABYLON.MeshBuilder.CreateLines("track",{points:s});l.color=new BABYLON.Color3(0,0,0);var c=[],h=[];const m={start:100,end:150,path:[]};var d=[];BABYLON.DeepCopier.DeepCopy(this.trackPoints,d);for(var p=0;p<a.length;p++)p>=m.start&&p<=m.end&&m.path.push(d[p]),h.push(a[p],s[p]);c.push(h);var B=BABYLON.MeshBuilder.CreateLineSystem("lane",{lines:c},this.scene);B.color=BABYLON.Color3.Gray().scale(.5),n.position.y=l.position.y=B.position.y=-1,this.createHills(a);var u=[];for(o=0;o<s.length;o++)u.push(s[0]);var g=BABYLON.MeshBuilder.CreateRibbon("ribb",{pathArray:[s,u],updatable:!0});g.position.y-=1.1,g.material=new BABYLON.SimpleMaterial,g.material.diffuseColor=BABYLON.Color3.FromHexString("#EB8C56"),g.increaseVertices(3),m.path.forEach(e=>{e.y-=10,e.x+=.8});var b=BABYLON.Curve3.CreateQuadraticBezier(new BABYLON.Vector3(9,9,0),new BABYLON.Vector3(0,20,0),new BABYLON.Vector3(-6,12,0),10);const f=BABYLON.MeshBuilder.ExtrudeShape("star",{shape:b.getPoints(),path:m.path,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);f.position.y-=1.5,f.flipFaces(),f.material=new BABYLON.SimpleMaterial,f.material.diffuseColor=BABYLON.Color3.Gray().scale(.5)},e.prototype.createPost=function(){return BABYLON.MeshBuilder.CreateBox("",{width:.2,height:5,depth:10})},e.prototype.createHills=function(e){var t=[];BABYLON.Tools.DeepCopy(e,t);noise.seed(.5);var a=new BABYLON.SpriteManager("treesManager","https://cdn.glitch.com/c9e2f109-17ee-4937-bdaf-b65c3829c52f%2Fpine-tree-png.png?v=1613176224654",2e3,800,scene);t.forEach(function(e,t){if(e.y=5*noise.perlin2(.05*e.x,.05*e.z),e.y+=10,e.scaleInPlace(1.2),0==Math.round(2*Math.random())){var i=new BABYLON.Sprite("tree",a);i.position.copyFrom(e),i.size=6,i.position.y+=1,i.color=new BABYLON.Color4(.45,.44,.44,.5)}}),BABYLON.MeshBuilder.CreateRibbon("hill",{pathArray:[e,t]}).flipFaces(),this.createHouses()};return e.prototype.createHouses=function(){},e.prototype.update=function(){if(0==this.levelEnd){this.player.position.y=3;const i=this.trainCarriage[this.trainCarriage.length-1];this.SPS.setParticles(),this.smokeContainer.rotation.y+=.008,this.smokeContainer.position.copyFrom(new BABYLON.Vector3(i.position.x,i.position.y+2,i.position.z));for(var e=0;e<this.trainCarriage.length-1;e++){var t=(e+1)%this.trainCarriage.length;this.trainCarriage[e].lookAt(this.trainCarriage[t].position),0==e&&this.trainCarriage[e].lookAt(i.position)}this.trainCarriage[2];var a=this.zombieTransform;0==this.zombieTransform.zombieLeft&&(this.zombieTransform.animationGroup.stop(),this.zombieTransform.animationGroup.reset(),a.hoardes.forEach((e,t)=>{e.setEnabled(!0),this.zombieTransform.zombieLeft=a.hoardes.length}),originFrame=this.trainCarriage[this.trainCarriage.length-1].animationGroup.animatables[0].getAnimations()[0].currentFrame,targetFrame=this.trainCarriage[4].animationGroup.animatables[0].getAnimations()[0].currentFrame,this.zombieTransform.animationGroup.start(!1,this.zombieSpeed,originFrame,targetFrame)),a.hoardes.forEach((e,t)=>{this.startHoard&&this.player.state.aabb.intersectsMesh(e.state.aabb,!0)&&e.isEnabled()&&(e.setEnabled(!1),this.health-=10,this.healthtext.text=`Health: ${this.health}%`,this.health<=50&&(this.healthtext.color="red"),this.health<1&&(this.levelEnd=!0)),e.smokeParticle&&(e.smokeParticle.mesh.lifetime--,e.smokeParticle.sps&&e.smokeParticle.sps.setParticles(),0==e.smokeParticle.mesh.lifetime&&(e.smokeParticle.mesh.dispose(),e.smokeParticle.sps.dispose(),e.smokeParticle=null,delete e.smokeParticle)),e.parent=a,e.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(0,Math.atan2(this.player.position.x-e.position.x,this.player.position.z-e.position.z)+3*Math.PI/2,0)})}else this.scene.stopAllAnimations(),this.scoreText.text=`\nGame Over!\nBest Score: ${localStorage.getItem("highscore")}`,this.menuBox.isVisible=!0},e}();window.initFunction=async function(){if(window.engine=await async function(){try{return createDefaultEngine()}catch(e){return console.log("the available createEngine function failed. Creating the default engine instead"),createDefaultEngine()}}(),!engine)throw"engine should not be null.";window.scene=CreateScene()},initFunction().then(()=>{sceneToRender=scene,engine.runRenderLoop(function(){sceneToRender&&sceneToRender.activeCamera&&sceneToRender.render()})}),window.addEventListener("resize",function(){engine.resize()});